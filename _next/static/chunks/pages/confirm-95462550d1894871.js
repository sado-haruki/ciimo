(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[161],{2061:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/confirm",function(){return t(6164)}])},6164:function(e,n,t){"use strict";t.r(n);var i=t(5893),r=t(1163),a=t(7294),c=t(83),o=t.n(c),l=t(9669),s=t.n(l),d=t(8969),u=t(1664),m=t(1205),f=t(8392);n.default=function(){var e=(0,r.useRouter)(),n=(0,a.useState)({}),t=n[0],c=n[1],l=(0,a.useState)({}),h=l[0],v=l[1],_=(0,a.useState)(!1),x=_[0],N=_[1],j=(0,a.useRef)([]),p=(0,a.useRef)(),I=(0,a.useState)(),b=I[0],w=I[1],S=(0,a.useState)(!1),g=S[0],k=S[1],C=(0,a.useCallback)((function(){var e=T(localStorage.getItem("reservation"));s().get("http://localhost:5000/theater/",{timeout:200}).then((function(n){var t,i,r,a=n.data;j.current=(null===(r=null===(i=null===(t=a.find((function(n){return n.id===e.theaterId})))||void 0===t?void 0:t.film.find((function(n){return n.id===e.filmId})))||void 0===i?void 0:i.schedule.find((function(n){return n.id===e.scheduleId})))||void 0===r?void 0:r.seat)||[],k(!0)})).catch((function(n){s().get("http://10.200.13.221:80/theater/").then((function(n){var t,i,r,a=n.data;j.current=(null===(r=null===(i=null===(t=a.find((function(n){return n.id===e.theaterId})))||void 0===t?void 0:t.film.find((function(n){return n.id===e.filmId})))||void 0===i?void 0:i.schedule.find((function(n){return n.id===e.scheduleId})))||void 0===r?void 0:r.seat)||[],k(!0)}))}))}),[]);(0,a.useEffect)((function(){c(F(localStorage.getItem("reservation"))),v(F(localStorage.getItem("reservationSeat"))),C()}),[C]);var F=function(e){return null!==e?JSON.parse(e):""},y=function(e){return e.film.find((function(e){return e.id===t.filmId})).schedule.find((function(e){return e.id===t.scheduleId})).seat.find((function(e){return e.row===h.row})).column.find((function(e){return e.seatName===h.seatName})).reserved=!0,e},T=function(e){return e?JSON.parse(e):null};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(d.Z,{}),(0,i.jsxs)("div",{className:o().container,children:[(0,i.jsx)(m.Z,{select:2}),(0,i.jsxs)("main",{className:o().main,children:[(0,i.jsx)("div",{className:o().items,children:(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:o().label,children:"\u6620\u753b\u9928"}),(0,i.jsx)("span",{className:o().item,children:t.theaterName})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:o().label,children:"\u4f5c\u54c1"}),(0,i.jsx)("span",{className:o().item,children:t.filmName})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:o().label,children:"\u4e0a\u6620\u65e5\u6642"}),(0,i.jsx)("span",{className:o().item,children:t.schedule})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:o().label,children:"\u5ea7\u5e2d"}),(0,i.jsxs)("span",{className:o().item,children:[h.row,"-",h.seatName]})]})]})}),(0,i.jsxs)("div",{className:o().buttons,children:[(0,i.jsx)("button",{onClick:function(){return e.push("../seatSelect")},className:o().back,children:"\u623b\u308b"}),(0,i.jsx)("button",{onClick:function(){s().get("http://localhost:5000/theater/".concat(t.theaterId)).then((function(n){var i,r,a,c=null===(i=n.data.film.find((function(e){return e.id===t.filmId})))||void 0===i?void 0:i.schedule.find((function(e){return e.id===t.scheduleId}));if(null===(a=null===(r=null===c||void 0===c?void 0:c.seat.find((function(e){return e.row===h.row})))||void 0===r?void 0:r.column.find((function(e){return e.seatName===h.seatName})))||void 0===a?void 0:a.reserved)return j.current=c.seat,void N(!0);var o=y(n.data);s().put("http://localhost:5000/theater/".concat(t.theaterId),{id:o.id,name:o.name,film:o.film}),e.push({pathname:"../complete",query:{paymentCode:"ABC".concat(t.theaterId).concat(t.filmId).concat(t.scheduleId).concat(h.row).concat(h.seatName)}})})).catch((function(n){s().get("http://10.200.13.221:80/theater/".concat(t.theaterId)).then((function(n){if(!function(e){var n,i,r,a;return null===(a=null===(r=null===(i=null===(n=e.film.find((function(e){return e.id===t.filmId})))||void 0===n?void 0:n.schedule.find((function(e){return e.id===t.scheduleId})))||void 0===i?void 0:i.seat.find((function(e){return e.row===h.row})))||void 0===r?void 0:r.column.find((function(e){return e.seatName===h.seatName})))||void 0===a?void 0:a.reserved}(n.data)){var i=y(n.data);s().put("http://10.200.13.221:80/theater/".concat(t.theaterId),{id:i.id,name:i.name,film:i.film}),e.push({pathname:"../complete",query:{paymentCode:"ABC".concat(t.theaterId).concat(t.filmId).concat(t.scheduleId).concat(h.row).concat(h.seatName)}})}}))}))},className:o().complete,children:"\u4e88\u7d04\u3092\u78ba\u5b9a\u3059\u308b"})]}),x?(0,i.jsx)("div",{className:o().overlay,children:(0,i.jsx)("div",{className:o().modalField,children:(0,i.jsxs)("div",{className:o().contants,children:[(0,i.jsxs)("div",{className:o().captions,children:[(0,i.jsx)("span",{className:o().erorrIcon,children:"!"}),(0,i.jsx)("span",{className:o().erorrText,children:"\u9078\u629e\u3055\u308c\u305f\u5e2d\u306f\u65e2\u306b\u4e88\u7d04\u3055\u308c\u3066\u3044\u307e\u3059"}),(0,i.jsx)("div",{children:"\u5ea7\u5e2d\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044"})]}),(0,i.jsx)("div",{className:o().selectField,children:g?(0,i.jsx)(f.Z,{seats:j.current,setSelectSeat:w||{}}):(0,i.jsx)(i.Fragment,{children:"\u8aad\u307f\u8fbc\u307f\u4e2d"})}),(0,i.jsxs)("div",{className:o().buttons,children:[(0,i.jsx)(u.default,{href:"/seatSelect",children:(0,i.jsx)("a",{children:(0,i.jsx)("button",{className:o().back,children:"\u5ea7\u5e2d\u9078\u629e\u753b\u9762\u306b\u623b\u308b"})})}),(0,i.jsx)(u.default,{href:"/confirm",children:(0,i.jsx)("a",{onClick:function(e){var n,t;e.stopPropagation(),C(),(null===(t=null===(n=j.current.find((function(e){var n;return e.row===(null===(n=p.current)||void 0===n?void 0:n.row)})))||void 0===n?void 0:n.column.find((function(e){var n;return e.seatName===(null===(n=p.current)||void 0===n?void 0:n.seatName)})))||void 0===t?void 0:t.reserved)?e.preventDefault():(localStorage.setItem("reservationSeat",JSON.stringify(b)),N(!1),v(F(localStorage.getItem("reservationSeat"))))},children:(0,i.jsx)("button",{className:o().confirm,children:"\u6c7a\u5b9a\u3059\u308b"})})})]})]})})}):(0,i.jsx)("div",{children:" "})]})]})]})}},83:function(e){e.exports={container:"confirm_container__nTVmj",main:"confirm_main__F8Pch",items:"confirm_items__jcbI4",label:"confirm_label__GJToG",item:"confirm_item__dIl6O",buttons:"confirm_buttons__U8QV6",back:"confirm_back__rPAQK",complete:"confirm_complete__vGs10",overlay:"confirm_overlay__tQk0z",modalField:"confirm_modalField__wmICL",contants:"confirm_contants__GRil_",captions:"confirm_captions__kzAKx",erorrIcon:"confirm_erorrIcon__VHxHA",erorrText:"confirm_erorrText__CkjHb",selectField:"confirm_selectField__noRut",screen:"confirm_screen__uVLfz",seats:"confirm_seats__Ydo0X",row:"confirm_row__Dz6kW",confirm:"confirm_confirm___UINI"}},1163:function(e,n,t){e.exports=t(387)}},function(e){e.O(0,[669,119,774,888,179],(function(){return n=2061,e(e.s=n);var n}));var n=e.O();_N_E=n}]);