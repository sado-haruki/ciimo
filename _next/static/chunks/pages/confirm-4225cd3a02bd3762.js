(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[161],{2061:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/confirm",function(){return t(6164)}])},6164:function(e,n,t){"use strict";t.r(n);var r=t(5893),i=t(1163),a=t(7294),c=t(83),s=t.n(c),o=t(9669),l=t.n(o),d=t(8969),u=t(1664),m=t(1764),f=t(1205);n.default=function(){var e=(0,i.useRouter)(),n=(0,a.useState)({}),t=n[0],c=n[1],o=(0,a.useState)({}),h=o[0],v=o[1],_=(0,a.useState)(!1),N=_[0],j=_[1],x=(0,a.useRef)([]),p=(0,a.useRef)(),I=(0,a.useState)(!1),b=I[0],w=I[1],k=(0,a.useCallback)((function(){var e=y(localStorage.getItem("reservation"));l().get("http://localhost:5000/theater/",{timeout:200}).then((function(n){var t,r,i,a=n.data;x.current=(null===(i=null===(r=null===(t=a.find((function(n){return n.id===e.theaterId})))||void 0===t?void 0:t.film.find((function(n){return n.id===e.filmId})))||void 0===r?void 0:r.schedule.find((function(n){return n.id===e.scheduleId})))||void 0===i?void 0:i.seat)||[],w(!0)})).catch((function(n){l().get("https://my-json-server.typicode.com/sado-haruki/dbjson/theater/").then((function(n){var t,r,i,a=n.data;x.current=(null===(i=null===(r=null===(t=a.find((function(n){return n.id===e.theaterId})))||void 0===t?void 0:t.film.find((function(n){return n.id===e.filmId})))||void 0===r?void 0:r.schedule.find((function(n){return n.id===e.scheduleId})))||void 0===i?void 0:i.seat)||[],w(!0)}))}))}),[]);(0,a.useEffect)((function(){c(S(localStorage.getItem("reservation"))),v(S(localStorage.getItem("reservationSeat"))),k()}),[k]);var S=function(e){return null!==e?JSON.parse(e):""},g=function(e){return e.film.find((function(e){return e.id===t.filmId})).schedule.find((function(e){return e.id===t.scheduleId})).seat.find((function(e){return e.row===h.row})).column.find((function(e){return e.seatName===h.seatName})).reserved=!0,e},y=function(e){return e?JSON.parse(e):null},C=function(e){var n={row:e.row,seatName:e.seatName};p.current=n};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(d.Z,{}),(0,r.jsxs)("div",{className:s().container,children:[(0,r.jsx)(f.Z,{select:2}),(0,r.jsxs)("main",{className:s().main,children:[(0,r.jsx)("div",{className:s().items,children:(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:s().label,children:"\u6620\u753b\u9928"}),(0,r.jsx)("span",{className:s().item,children:t.theaterName})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:s().label,children:"\u4f5c\u54c1"}),(0,r.jsx)("span",{className:s().item,children:t.filmName})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:s().label,children:"\u4e0a\u6620\u65e5\u6642"}),(0,r.jsx)("span",{className:s().item,children:t.schedule})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:s().label,children:"\u5ea7\u5e2d"}),(0,r.jsxs)("span",{className:s().item,children:[h.row,"-",h.seatName]})]})]})}),(0,r.jsxs)("div",{className:s().buttons,children:[(0,r.jsx)("button",{onClick:function(){return e.push("../seatSelect")},className:s().back,children:"\u623b\u308b"}),(0,r.jsx)("button",{onClick:function(){l().get("http://localhost:5000/theater/".concat(t.theaterId)).then((function(n){var r,i,a,c=null===(r=n.data.film.find((function(e){return e.id===t.filmId})))||void 0===r?void 0:r.schedule.find((function(e){return e.id===t.scheduleId}));if(null===(a=null===(i=null===c||void 0===c?void 0:c.seat.find((function(e){return e.row===h.row})))||void 0===i?void 0:i.column.find((function(e){return e.seatName===h.seatName})))||void 0===a?void 0:a.reserved)return x.current=c.seat,void j(!0);var s=g(n.data);l().put("http://localhost:5000/theater/".concat(t.theaterId),{id:s.id,name:s.name,film:s.film}),e.push({pathname:"../complete",query:{paymentCode:"ABC".concat(t.theaterId).concat(t.filmId).concat(t.scheduleId).concat(h.row).concat(h.seatName)}})})).catch((function(n){l().get("https://my-json-server.typicode.com/sado-haruki/dbjson/theater/".concat(t.theaterId)).then((function(n){if(!function(e){var n,r,i,a;return null===(a=null===(i=null===(r=null===(n=e.film.find((function(e){return e.id===t.filmId})))||void 0===n?void 0:n.schedule.find((function(e){return e.id===t.scheduleId})))||void 0===r?void 0:r.seat.find((function(e){return e.row===h.row})))||void 0===i?void 0:i.column.find((function(e){return e.seatName===h.seatName})))||void 0===a?void 0:a.reserved}(n.data)){var r=g(n.data);l().put("https://my-json-server.typicode.com/sado-haruki/dbjson/theater/".concat(t.theaterId),{id:r.id,name:r.name,film:r.film}),e.push({pathname:"../complete",query:{paymentCode:"ABC".concat(t.theaterId).concat(t.filmId).concat(t.scheduleId).concat(h.row).concat(h.seatName)}})}}))}))},className:s().complete,children:"\u4e88\u7d04\u3092\u78ba\u5b9a\u3059\u308b"})]}),N?(0,r.jsx)("div",{className:s().overlay,children:(0,r.jsx)("div",{className:s().modalField,children:(0,r.jsxs)("div",{className:s().contants,children:[(0,r.jsxs)("div",{className:s().captions,children:[(0,r.jsx)("span",{className:s().erorrIcon,children:"!"}),(0,r.jsx)("span",{className:s().erorrText,children:"\u9078\u629e\u3055\u308c\u305f\u5e2d\u306f\u65e2\u306b\u4e88\u7d04\u3055\u308c\u3066\u3044\u307e\u3059"}),(0,r.jsx)("div",{children:"\u5ea7\u5e2d\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044"})]}),(0,r.jsx)("div",{className:s().selectField,children:b?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:s().screen,children:"SCREEN"}),x.current.map((function(e,n){return(0,r.jsxs)("div",{className:s().seats,children:[(0,r.jsx)("span",{className:s().row,children:e.row}),e.column.map((function(n,t){return(0,r.jsx)(m.Z,{selectedSeat:p.current||{},reserved:n.reserved,clickSeat:C,seat:{row:e.row,seatName:n.seatName}},t)})),(0,r.jsx)("div",{className:s().row,children:e.row},n)]},n)}))]}):(0,r.jsx)(r.Fragment,{children:"\u8aad\u307f\u8fbc\u307f\u4e2d"})}),(0,r.jsxs)("div",{className:s().buttons,children:[(0,r.jsx)(u.default,{href:"/seatSelect",children:(0,r.jsx)("a",{children:(0,r.jsx)("button",{className:s().back,children:"\u5ea7\u5e2d\u9078\u629e\u753b\u9762\u306b\u623b\u308b"})})}),(0,r.jsx)(u.default,{href:"/confirm",children:(0,r.jsx)("a",{onClick:function(e){var n,t;e.stopPropagation(),k(),(null===(t=null===(n=x.current.find((function(e){var n;return e.row===(null===(n=p.current)||void 0===n?void 0:n.row)})))||void 0===n?void 0:n.column.find((function(e){var n;return e.seatName===(null===(n=p.current)||void 0===n?void 0:n.seatName)})))||void 0===t?void 0:t.reserved)?e.preventDefault():(localStorage.setItem("reservationSeat",JSON.stringify(p.current)),j(!1),v(S(localStorage.getItem("reservationSeat"))))},children:(0,r.jsx)("button",{className:s().confirm,children:"\u6c7a\u5b9a\u3059\u308b"})})})]})]})})}):(0,r.jsx)("div",{children:" "})]})]})]})}},83:function(e){e.exports={container:"confirm_container__nTVmj",main:"confirm_main__F8Pch",items:"confirm_items__jcbI4",label:"confirm_label__GJToG",item:"confirm_item__dIl6O",buttons:"confirm_buttons__U8QV6",back:"confirm_back__rPAQK",complete:"confirm_complete__vGs10",overlay:"confirm_overlay__tQk0z",modalField:"confirm_modalField__wmICL",contants:"confirm_contants__GRil_",captions:"confirm_captions__kzAKx",erorrIcon:"confirm_erorrIcon__VHxHA",erorrText:"confirm_erorrText__CkjHb",selectField:"confirm_selectField__noRut",screen:"confirm_screen__uVLfz",seats:"confirm_seats__Ydo0X",row:"confirm_row__Dz6kW",confirm:"confirm_confirm___UINI"}},1163:function(e,n,t){e.exports=t(387)}},function(e){e.O(0,[669,206,774,888,179],(function(){return n=2061,e(e.s=n);var n}));var n=e.O();_N_E=n}]);